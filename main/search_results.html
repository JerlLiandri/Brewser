<html>
    <head>
        <script
        src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous">
        
    </script>
    <link rel="stylesheet" type="text/css" href="styles/search_results.css">
           <!-- Loading header/footer -->
    <script> 
        $(function(){
          $("#header").load("components/header.html"); 
          $("#footer").load("components/footer.html"); 
        });
        
        </script> 
          
        
    </head>
    <body>
        <div id="header"></div>
        <div id="container">
            <div id="card-container">
            </div>
            <div id="loader">
              <div class="skeleton-card"></div>
              <div class="skeleton-card"></div>
              <div class="skeleton-card"></div>
            </div>
            <div class="card-actions">
              <span>Showing 
                <span id="card-count"></span> of 
                <span id="card-total"></span> results      
              </span>
            </div>








        </div>
        <div id="footer"></div>

        <script>
            const cardContainer = document.getElementById("card-container");
            const cardCountElem = document.getElementById("card-count");
            const cardTotalElem = document.getElementById("card-total");
            const loader = document.getElementById("loader");

            const cardLimit = 99;
            const cardIncrease = 9;
            const pageCount = Math.ceil(cardLimit / cardIncrease);
            let currentPage = 1;

            cardTotalElem.innerHTML = cardLimit;

            var throttleTimer;
            const throttle = (callback, time) => {
            if (throttleTimer) return;

            throttleTimer = true;

            setTimeout(() => {
                callback();
                throttleTimer = false;
            }, time);
            };

            const getRandomColor = () => {
            const h = Math.floor(Math.random() * 360);

            return `hsl(${h}deg, 90%, 85%)`;
            };

            const createCard = (index) => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = index;
            card.style.backgroundColor = getRandomColor();
            cardContainer.appendChild(card);
            };

            const addCards = (pageIndex) => {
            currentPage = pageIndex;

            const startRange = (pageIndex - 1) * cardIncrease;
            const endRange =
                currentPage == pageCount ? cardLimit : pageIndex * cardIncrease;

            cardCountElem.innerHTML = endRange;

            for (let i = startRange + 1; i <= endRange; i++) {
                createCard(i);
            }
            };

            const handleInfiniteScroll = () => {
            throttle(() => {
                const endOfPage =
                window.innerHeight + window.pageYOffset >= document.body.offsetHeight;

                if (endOfPage) {
                addCards(currentPage + 1);
                }

                if (currentPage === pageCount) {
                removeInfiniteScroll();
                }
            }, 1000);
            };

            const removeInfiniteScroll = () => {
            loader.remove();
            window.removeEventListener("scroll", handleInfiniteScroll);
            };

            window.onload = function () {
            addCards(currentPage);
            };

            window.addEventListener("scroll", handleInfiniteScroll);
        </script>
    </body>
</html>